# PRD: 太初星集电子签章系统

## 基本信息

- **项目**: tc-qianming
- **功能**: 太初星集电子签章系统
- **创建时间**: 2026-01-01
- **优先级**: P0 紧急
- **MVP 范围**: 完整版

## 功能概述

太初星集电子签章系统是一个企业级电子签章解决方案，支持企业内部和个人用户的合同签署需求。
系统提供公章管理、合同盖章、个人签字、骑缝章等核心功能，支持自定义坐标精确定位盖章位置。

## 核心场景

### 1. 企业内部签章
- 公司内部合同签署
- 审批文件盖章
- 企业公章、合同章、财务章管理

### 2. 个人用户签署
- C端用户协议签署
- 个人签名管理（手写/上传/字体生成）

## 技术范围

| 层级 | 技术选型 | 说明 |
|------|----------|------|
| 前端 | Next.js | Web 端管理界面 |
| 后端 | Spring Boot | Java 后端服务 |
| 数据库 | MySQL | 关系型数据库 |
| PDF处理 | Apache PDFBox | PDF 操作库 |
| 文件存储 | 本地服务器 | 本地磁盘存储 |

## 详细需求

### 一、公章管理模块

#### 1.1 印章类型
- 企业公章（圆形）
- 合同专用章
- 财务章
- 个人签名章

#### 1.2 印章来源
- **图片上传**: 管理员上传已有印章图片（PNG/透明背景）
- **系统生成**: 根据企业名称自动生成标准印章
- **模板选择**: 提供多种印章模板供选择

#### 1.3 印章管理功能
- 印章新增、编辑、删除
- 印章启用/禁用
- 印章使用权限设置
- 印章使用记录查询

### 二、合同盖章模块

#### 2.1 文件上传
- 支持 PDF 格式上传
- 文件大小限制（建议 50MB）
- 文件预览功能

#### 2.2 盖章功能
- **自定义坐标**: 支持精确 X/Y 坐标定位
- **可视化选择**: 在 PDF 预览页面点击选择位置
- **多位置盖章**: 一份合同支持多个盖章位置
- **印章缩放**: 支持调整印章大小

#### 2.3 骑缝章
- 自动分割模式：根据 PDF 总页数自动分割印章
- 印章按比例分配到每页边缘
- 组合后形成完整印章图案

### 三、个人签字模块

#### 3.1 签名方式
- **图片上传**: 上传个人签名图片
- **在线手写**: 手写板组件实时绘制签名
- **字体生成**: 选择字体自动生成签名

#### 3.2 签名管理
- 签名保存与管理
- 默认签名设置
- 签名历史记录

### 四、签章记录模块

- 签章操作记录
- 签章时间戳
- 签章人员信息
- 原始文件与签章后文件关联

## 任务拆分

### 数据库任务 (4个)
1. [database] 印章信息表设计 (seal_info)
2. [database] 签章记录表设计 (seal_record)
3. [database] 合同文件表设计 (contract_file)
4. [database] 个人签名表设计 (personal_signature)

### 后端任务 (8个)
1. [backend] 印章管理 CRUD API
2. [backend] 印章图片上传接口
3. [backend] 印章自动生成服务
4. [backend] PDF 上传与预览接口
5. [backend] 盖章处理接口（含坐标定位）
6. [backend] 骑缝章生成逻辑
7. [backend] 个人签名管理接口
8. [backend] 手写签名/字体签名生成接口

### 前端任务 (6个)
1. [frontend] 印章管理页面
2. [frontend] 印章模板选择/生成组件
3. [frontend] PDF 预览与盖章位置选择组件
4. [frontend] 在线手写签名组件
5. [frontend] 合同列表与盖章记录页面
6. [frontend] 签章流程主页面

### 文档任务 (1个)
1. [docs] API 接口文档

## 验收标准

### 公章管理
- [ ] 可以上传/生成/选择模板创建印章
- [ ] 印章支持增删改查操作
- [ ] 印章图片正确显示

### 合同盖章
- [ ] PDF 文件可正常上传和预览
- [ ] 可通过点击或输入坐标选择盖章位置
- [ ] 支持多位置盖章
- [ ] 盖章后生成新的 PDF 文件

### 骑缝章
- [ ] 骑缝章自动按页数分割
- [ ] 各页印章部分正确对齐

### 个人签字
- [ ] 支持上传签名图片
- [ ] 手写板可正常绑定和保存签名
- [ ] 字体生成签名正确显示

### 签章记录
- [ ] 所有签章操作有记录
- [ ] 可追溯签章时间和操作人

## 非功能性需求

### 性能要求
- PDF 处理响应时间 < 5秒（100页以内）
- 单文件大小限制 50MB

### 安全要求
- 印章图片加密存储
- 操作日志完整记录
- 权限控制

## 需求收集记录

<details>
<summary>对话历史</summary>

**第一轮 - 基础信息**
- 使用场景: 企业内部、个人用户
- 印章类型: 企业公章、合同专用章、财务章、个人签名
- 骑缝章方式: 自动分割
- 个人签字: 图片上传、手写板、字体生成

**第二轮 - 技术细节**
- 文件存储: 本地服务器
- 审批流程: 直接盖章（无需审批）
- 多位置盖章: 支持
- 前端技术: Next.js

**第三轮 - 框架确认**
- PDF处理库: Apache PDFBox
- 后端框架: Spring Boot
- 验签功能: MVP 不做
- 印章来源: 上传图片、系统生成、模板选择

**最终确认**
- 优先级: P0 紧急
- MVP 范围: 完整版

</details>
